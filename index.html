<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Inventario Kanban</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom styles for drag and drop feedback */
        .dragging {
            opacity: 0.5;
            border: 2px dashed #3B82F6; /* Blue-500 */
        }
        .drag-over {
            background-color: #DBEAFE; /* Blue-100 */
        }
        /* Custom scrollbar for columns */
        .kanban-column {
            max-height: calc(100vh - 220px); /* Adjust based on header/footer height */
            overflow-y: auto;
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #9CA3AF #F3F4F6; /* thumb and track color */
        }
        .kanban-column::-webkit-scrollbar {
            width: 8px;
        }
        .kanban-column::-webkit-scrollbar-track {
            background: #F3F4F6; /* Gray-100 */
            border-radius: 10px;
        }
        .kanban-column::-webkit-scrollbar-thumb {
            background-color: #9CA3AF; /* Gray-400 */
            border-radius: 10px;
            border: 2px solid #F3F4F6;
        }
        /* Ensure select dropdowns are visible */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">
    <div id="app" class="min-h-screen flex flex-col">
        <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-lg rounded-b-xl">
            <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-3xl font-bold mb-2 sm:mb-0">Gestor de Inventario del Hogar</h1>
                <div class="text-sm">
                    <!-- User ID Display Removed -->
                </div>
            </div>
        </header>

        <div id="loadingIndicator" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl flex items-center space-x-3">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                <p class="text-lg font-semibold text-gray-700">Cargando datos...</p>
            </div>
        </div>

        <main class="container mx-auto p-4 flex-grow">
            <section class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Añadir Nuevo Artículo</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div>
                        <label for="itemName" class="block text-sm font-medium text-gray-600 mb-1">Nombre del Artículo</label>
                        <input type="text" id="itemName" placeholder="Ej: Arroz"
                               class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div class="flex gap-2">
                        <div class="flex-grow">
                            <label for="itemQuantity" class="block text-sm font-medium text-gray-600 mb-1">Cantidad</label>
                            <input type="number" id="itemQuantity" value="1" min="0" step="any"
                                   class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                        </div>
                        <div>
                            <label for="itemUnit" class="block text-sm font-medium text-gray-600 mb-1">Unidad</label>
                            <select id="itemUnit" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm appearance-none">
                                <option value="Uds.">Uds.</option>
                                <option value="kg">kg</option>
                                <option value="g">g</option>
                                <option value="L">L</option>
                                <option value="ml">ml</option>
                                <option value="Paquetes">Paquetes</option>
                                <option value="Latas">Latas</option>
                                <option value="Botellas">Botellas</option>
                                <option value="Rollos">Rollos</option>
                                <option value="Cajas">Cajas</option>
                            </select>
                        </div>
                    </div>
                     <div>
                        <label for="itemColumn" class="block text-sm font-medium text-gray-600 mb-1">Categoría Inicial</label>
                        <select id="itemColumn" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm appearance-none">
                            <option value="inStock">En Stock</option>
                            <option value="runningLow">Por agotarse</option>
                            <option value="outOfStockToBuy" selected>Sin Stock (a comprar)</option>
                        </select>
                    </div>
                    <button id="addItemBtn"
                            class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 shadow-md">
                        <i class="fas fa-plus mr-2"></i>Añadir Artículo
                    </button>
                </div>
                <p id="addError" class="text-red-500 text-sm mt-2 hidden">El nombre del artículo no puede estar vacío.</p>
            </section>

            <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div id="column-inStock" class="kanban-column bg-green-50 p-4 rounded-lg shadow-md border border-green-200">
                    <h3 class="text-xl font-semibold mb-4 text-green-700 border-b pb-2 border-green-300">
                        <i class="fas fa-check-circle mr-2"></i>En Stock
                    </h3>
                    <div class="space-y-4 min-h-[100px]" data-column-id="inStock">
                        </div>
                </div>

                <div id="column-runningLow" class="kanban-column bg-yellow-50 p-4 rounded-lg shadow-md border border-yellow-200">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-700 border-b pb-2 border-yellow-300">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Por agotarse
                    </h3>
                    <div class="space-y-4 min-h-[100px]" data-column-id="runningLow">
                        </div>
                </div>

                <div id="column-outOfStockToBuy" class="kanban-column bg-red-50 p-4 rounded-lg shadow-md border border-red-200">
                    <h3 class="text-xl font-semibold mb-4 text-red-700 border-b pb-2 border-red-300">
                        <i class="fas fa-shopping-cart mr-2"></i>Sin Stock (a comprar)
                    </h3>
                    <div class="space-y-4 min-h-[100px]" data-column-id="outOfStockToBuy">
                        </div>
                </div>
            </section>
        </main>

        <footer class="bg-gray-200 text-gray-600 p-3 text-center text-sm rounded-t-lg mt-auto">
            <p id="lastUpdatedMessage">Actualizando información...</p>
        </footer>

        <div id="editModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/3 max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Editar Artículo</h3>
                <label for="editItemName" class="block text-sm font-medium text-gray-600 mb-1">Nombre</label>
                <input type="text" id="editItemName" class="w-full p-3 border border-gray-300 rounded-md mb-4">
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="editItemQuantity" class="block text-sm font-medium text-gray-600 mb-1">Cantidad</label>
                        <input type="number" id="editItemQuantity" class="w-full p-3 border border-gray-300 rounded-md" min="0" step="any">
                    </div>
                    <div>
                        <label for="editItemUnit" class="block text-sm font-medium text-gray-600 mb-1">Unidad</label>
                        <select id="editItemUnit" class="w-full p-3 border border-gray-300 rounded-md appearance-none">
                            <option value="Uds.">Uds.</option>
                            <option value="kg">kg</option>
                            <option value="g">g</option>
                            <option value="L">L</option>
                            <option value="ml">ml</option>
                            <option value="Paquetes">Paquetes</option>
                            <option value="Latas">Latas</option>
                            <option value="Botellas">Botellas</option>
                            <option value="Rollos">Rollos</option>
                            <option value="Cajas">Cajas</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelEditBtn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-400 transition duration-200">Cancelar</button>
                    <button id="saveEditBtn" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">Guardar Cambios</button>
                </div>
            </div>
        </div>

        <div id="deleteConfirmModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/3">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Confirmar Eliminación</h3>
                <p class="text-gray-600 mb-6">¿Estás seguro de que quieres eliminar este artículo?</p>
                <div class="flex justify-end space-x-3">
                    <button id="cancelDeleteBtn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-400 transition duration-200">Cancelar</button>
                    <button id="confirmDeleteBtn" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition duration-200">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // JSONBin.io Constants and Global State
        const JSONBIN_API_KEY = "$2a$10$Ij740FOBuAEn6dTZ7sNl9uWbnx/GdYuOi5ZNSZ9ak3RCDgb69rWfe";
        const JSONBIN_BIN_ID = "683b1caa8561e97a501de569";
        const JSONBIN_BASE_URL = "https://api.jsonbin.io/v3/b";
        let localGroceryItems = [];
        let isSaving = false;
        let pollingIntervalId = null;
        const POLLING_INTERVAL = 15000; // 15 seconds

        // DOM Elements
        const itemNameInput = document.getElementById('itemName');
        const itemQuantityInput = document.getElementById('itemQuantity');
        const itemUnitInput = document.getElementById('itemUnit');
        const itemColumnInput = document.getElementById('itemColumn');
        const addItemBtn = document.getElementById('addItemBtn');
        const addError = document.getElementById('addError');
        // const userIdDisplay = document.getElementById('userIdDisplay'); // Removed
        const loadingIndicator = document.getElementById('loadingIndicator');
        const lastUpdatedMessage = document.getElementById('lastUpdatedMessage');

        // Modals elements
        const editModal = document.getElementById('editModal');
        const editItemNameInput = document.getElementById('editItemName');
        const editItemQuantityInput = document.getElementById('editItemQuantity');
        const editItemUnitInput = document.getElementById('editItemUnit');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const saveEditBtn = document.getElementById('saveEditBtn');

        const deleteConfirmModal = document.getElementById('deleteConfirmModal');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        let currentEditingItem = null;

        // --- Utility Functions ---
        // function generateFallbackId(prefix = "id") { // Potentially re-use for item IDs if needed
        //     return `${prefix}-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
        // }
        // Removed Firebase-specific utility functions

        // --- Loading Indicator ---
        function showLoading() {
            if(loadingIndicator) loadingIndicator.classList.remove('hidden');
            else console.error("loadingIndicator element not found");
        }
        function hideLoading() {
            if(loadingIndicator) loadingIndicator.classList.add('hidden');
            else console.error("loadingIndicator element not found during hide");
        }

        // --- JSONBin.io Core Data Functions ---
        async function loadGroceries() {
            showLoading();
            lastUpdatedMessage.textContent = "Cargando lista...";
            try {
                const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                if (response.ok) {
                    const recordWrapper = await response.json();
                    // Data is nested under 'record'. If bin is new/empty, recordWrapper.record might be just an empty object or not have 'items'.
                    if (recordWrapper && recordWrapper.record && Array.isArray(recordWrapper.record.items)) {
                        localGroceryItems = recordWrapper.record.items;
                    } else if (recordWrapper && recordWrapper.record && Object.keys(recordWrapper.record).length === 0) {
                        // Bin exists but is empty (e.g. {}). Initialize as empty list.
                        localGroceryItems = [];
                         console.log("Bin is empty, initializing with an empty list.");
                    }
                    else {
                        // Bin might not be structured with an 'items' array yet, or other unexpected structure.
                        localGroceryItems = [];
                        console.warn("Loaded data is not in the expected format (no 'items' array in record), initializing with empty list. Data:", recordWrapper);
                    }
                    renderItems(localGroceryItems);
                    lastUpdatedMessage.textContent = "Lista cargada correctamente.";
                } else {
                    const errorData = await response.text();
                    console.error("Error loading list from JSONBin.io:", response.status, errorData);
                    lastUpdatedMessage.textContent = `Error cargando lista: ${response.status}. Puede que el BIN ID sea incorrecto o no exista.`;
                     // Optional: Clear local items if load fails, or keep stale data.
                    // localGroceryItems = []; renderItems(localGroceryItems);
                }
            } catch (error) {
                console.error("Network or other error loading groceries:", error);
                lastUpdatedMessage.textContent = "Error de red al cargar la lista.";
            } finally {
                hideLoading();
            }
        }

        async function saveGroceries() {
            if (isSaving) return;
            isSaving = true;
            // showLoading(); // Optional: use a different indicator for saving or rely on lastUpdatedMessage
            lastUpdatedMessage.textContent = "Guardando lista...";
            try {
                const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify({ items: localGroceryItems }) // Store items under an "items" key
                });
                if (response.ok) {
                    lastUpdatedMessage.textContent = `Lista guardada a las ${new Date().toLocaleTimeString()}.`;
                } else {
                    const errorData = await response.text();
                    console.error("Error saving list to JSONBin.io:", response.status, errorData);
                    lastUpdatedMessage.textContent = `Error guardando lista: ${response.status}.`;
                }
            } catch (error) {
                console.error("Network or other error saving groceries:", error);
                lastUpdatedMessage.textContent = "Error de red al guardar la lista.";
            } finally {
                // hideLoading();
                isSaving = false;
            }
        }
        // Removed updateLastModified function, will be handled by saveGroceries if needed

        // --- Item Card Creation ---
        function createItemCard(item) {
            const card = document.createElement('div');
            card.id = `item-${item.id}`;
            card.draggable = true;
            card.classList.add('bg-white', 'p-3', 'rounded-lg', 'shadow', 'border', 'border-gray-200', 'flex', 'flex-col', 'gap-2', 'cursor-grab', 'hover:shadow-md', 'transition-shadow');
            card.setAttribute('data-item-id', item.id);
            card.setAttribute('data-column-id', item.column);

            let borderColorClass = 'border-gray-200';
            if (item.column === 'inStock') borderColorClass = 'border-green-300';
            else if (item.column === 'runningLow') borderColorClass = 'border-yellow-300';
            else if (item.column === 'outOfStockToBuy') borderColorClass = 'border-red-300';
            card.classList.replace('border-gray-200', borderColorClass);

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <span class="font-semibold text-md text-gray-800 break-all">${item.name}</span>
                    <div class="flex space-x-2 flex-shrink-0 ml-2">
                        <button class="edit-btn text-blue-500 hover:text-blue-700 transition duration-150 p-1" title="Editar">
                            <i class="fas fa-edit fa-sm"></i>
                        </button>
                        <button class="delete-btn text-red-500 hover:text-red-700 transition duration-150 p-1" title="Eliminar">
                            <i class="fas fa-trash-alt fa-sm"></i>
                        </button>
                    </div>
                </div>
                <p class="text-gray-600 text-xs">Cantidad: <span class="font-medium">${item.quantity} ${item.unit || ''}</span></p>
            `;

            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);

            card.querySelector('.edit-btn').addEventListener('click', (e) => {
                e.stopPropagation(); 
                openEditModal(item);
            });
            card.querySelector('.delete-btn').addEventListener('click', (e) => {
                e.stopPropagation(); 
                openDeleteConfirmModal(item);
            });
            return card;
        }

        // --- Render Items ---
        function renderItems(items) {
            document.querySelectorAll('.kanban-column > div[data-column-id]').forEach(colContainer => colContainer.innerHTML = '');
            items.forEach(item => {
                const columnElement = document.querySelector(`.kanban-column > div[data-column-id="${item.column}"]`);
                if (columnElement) {
                    columnElement.appendChild(createItemCard(item));
                } else {
                    console.warn(`Column ${item.column} not found for item ${item.name}. Defaulting to 'outOfStockToBuy'.`);
                    const fallbackColumn = document.querySelector(`.kanban-column > div[data-column-id="outOfStockToBuy"]`);
                    if (fallbackColumn) {
                        const correctedItem = {...item, column: 'outOfStockToBuy'}; // Correct the item's column before rendering
                        fallbackColumn.appendChild(createItemCard(correctedItem));
                    } else {
                        console.error("Fallback column 'outOfStockToBuy' also not found. Cannot render item:", item.name);
                    }
                }
            });
        }

        // Removed setupRealtimeListeners (Firebase specific)

        // --- Add New Item ---
        addItemBtn.addEventListener('click', async () => {
            const name = itemNameInput.value.trim();
            const quantity = parseFloat(itemQuantityInput.value);
            const unit = itemUnitInput.value;
            const column = itemColumnInput.value;

            if (!name) {
                addError.textContent = "El nombre del artículo no puede estar vacío.";
                addError.classList.remove('hidden');
                return;
            }
            if (isNaN(quantity) || quantity < 0) {
                addError.textContent = "La cantidad debe ser un número válido y no negativo.";
                addError.classList.remove('hidden');
                return;
            }
            addError.classList.add('hidden');

            // JSONBin.io: No auth check needed here, handled by API key
            // Removed Firebase specific checks and serverTimestamp

            const newItem = {
                id: 'item-' + Date.now() + '-' + Math.random().toString(36).substring(2, 9), // Client-side ID
                name: name,
                quantity: quantity,
                unit: unit,
                column: column,
                // createdAt: new Date().toISOString() // Optional: client-side timestamp
            };

            localGroceryItems.push(newItem);
            renderItems(localGroceryItems);
            await saveGroceries(); // Save to JSONBin.io

            itemNameInput.value = '';
            itemQuantityInput.value = '1';
            itemUnitInput.value = 'Uds.';
            itemColumnInput.value = 'outOfStockToBuy';
        });

        // --- Drag and Drop Functionality ---
        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', draggedItem.id);
            setTimeout(() => {
                if (draggedItem) draggedItem.classList.add('dragging');
            }, 0);
        }

        function handleDragEnd() {
            if (draggedItem) {
                draggedItem.classList.remove('dragging');
            }
            draggedItem = null;
            document.querySelectorAll('.kanban-column > div[data-column-id]').forEach(col => col.classList.remove('drag-over'));
        }

        document.querySelectorAll('.kanban-column > div[data-column-id]').forEach(columnContainer => {
            columnContainer.addEventListener('dragover', e => {
                e.preventDefault();
                if (columnContainer !== draggedItem?.parentNode) { 
                    columnContainer.classList.add('drag-over');
                }
            });
            columnContainer.addEventListener('dragleave', e => {
                if (!columnContainer.contains(e.relatedTarget)) {
                    columnContainer.classList.remove('drag-over');
                }
            });
            columnContainer.addEventListener('drop', async e => {
                e.preventDefault();
                columnContainer.classList.remove('drag-over');

                if (draggedItem && draggedItem.parentNode !== columnContainer) {
                    const newColumnId = columnContainer.getAttribute('data-column-id');
                    const itemId = draggedItem.getAttribute('data-item-id');

                    // JSONBin.io: Update local array and save
                    const itemIndex = localGroceryItems.findIndex(item => item.id === itemId);
                    if (itemIndex > -1) {
                        localGroceryItems[itemIndex].column = newColumnId;
                        // localGroceryItems[itemIndex].updatedAt = new Date().toISOString(); // Optional
                        renderItems(localGroceryItems); // Re-render immediately for responsiveness
                        await saveGroceries();
                    } else {
                        console.error("Dropped item not found in localGroceryItems:", itemId);
                    }
                }
                draggedItem = null;
            });
        });

        // --- Modal Functions ---
        function openEditModal(item) {
            currentEditingItem = item;
            editItemNameInput.value = item.name;
            editItemQuantityInput.value = item.quantity;
            editItemUnitInput.value = item.unit || 'Uds.'; 
            editModal.classList.remove('hidden');
        }

        function closeEditModal() {
            editModal.classList.add('hidden');
            currentEditingItem = null;
        }

        saveEditBtn.addEventListener('click', async () => {
            if (currentEditingItem) {
                const newName = editItemNameInput.value.trim();
                const newQuantity = parseFloat(editItemQuantityInput.value);
                const newUnit = editItemUnitInput.value;

                if (!newName) {
                    // Consider showing this error in the modal UI instead of just console.log
                    console.log("El nombre no puede estar vacío."); 
                    return;
                }
                 if (isNaN(newQuantity) || newQuantity < 0) {
                    console.log("La cantidad debe ser un número válido y no negativo."); 
                    return;
                }

                // JSONBin.io: Update local array and save
                const itemIndex = localGroceryItems.findIndex(item => item.id === currentEditingItem.id);
                if (itemIndex > -1) {
                    localGroceryItems[itemIndex].name = newName;
                    localGroceryItems[itemIndex].quantity = newQuantity;
                    localGroceryItems[itemIndex].unit = newUnit;
                    // localGroceryItems[itemIndex].updatedAt = new Date().toISOString(); // Optional
                    renderItems(localGroceryItems);
                    await saveGroceries();
                    closeEditModal();
                } else {
                     console.error("Item to edit not found in localGroceryItems:", currentEditingItem.id);
                     // Optionally show error to user
                }
            }
        });
        cancelEditBtn.addEventListener('click', closeEditModal);

        function openDeleteConfirmModal(item) {
            currentEditingItem = item;
            deleteConfirmModal.classList.remove('hidden');
        }

        function closeDeleteConfirmModal() {
            deleteConfirmModal.classList.add('hidden');
            currentEditingItem = null;
        }

        confirmDeleteBtn.addEventListener('click', async () => {
            if (currentEditingItem) {
                // JSONBin.io: Update local array and save
                localGroceryItems = localGroceryItems.filter(item => item.id !== currentEditingItem.id);
                renderItems(localGroceryItems);
                await saveGroceries();
                closeDeleteConfirmModal();
            }
        });
        cancelDeleteBtn.addEventListener('click', closeDeleteConfirmModal);

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', async () => { // Made async for initial load
            showLoading(); // Show loading indicator at the very start
            await loadGroceries(); // Load initial data
            hideLoading(); // Hide loading indicator after initial load

            if (pollingIntervalId) clearInterval(pollingIntervalId); // Clear existing interval if any
            pollingIntervalId = setInterval(loadGroceries, POLLING_INTERVAL); // Start polling
        });
    </script>
</body>
</html>
